$datetime = get-date -f yyyy-MM-dd_HH-mm;
$logfile = "C:\Rocketmiles\PS\Transcripts\PSTranscript_$datetime.txt";
Start-transcript $logfile -NoClobber;

Set-Location C:\rocketmiles\Amazon\
#set download directory [CWD].

$i = 1;
#Set Loop Counter.

$SESSIONS = @("0194EEFD854148A9EDAC1438FAF0088C-n1","03D1F25D32883ABE0DE04005DCC8D8D6-n1",`
"070EC3BEAA926C86C09639217B6266C3-n1","084706866F19975350BE9A896FF12E33-n1","088E60D4268C734D8629511D26B64D45-n1",`
"0E39E47C225EAEB833970AAC65BE2CA2-n1","14C39CDF4210C099231AED186664D216-n1","15D954E83181C700F325D75D45BD2AAA-n1",`
"168C33BF1A689C0068E9CD16BEB69C7B-n1","1A5C989C8F728E63B8005788EB9CD320-n1","1A8F8986ED5627C5D80426879439F66E-n1",`
"1AF81390AB4A572FC84DCE359427AC8B-n1","1B9BE9BE4DA2E8A82AFC40CC433DEABC-n1","1BBDBD73CF3BF25AF9A43A6A27F05D8E-n1",`
"1D13D54925CBB76F0D8565AA3423A7A3-n1","1D20C85593B129C993ECC1D4D0EBD8E9-n1","1DD42A597DCE046BF6E8BAF85D711279-n1",`
"2197337C555800580AA585568087A8A1-n1","2470ED82A4AC9927305BDDF17B7F66BB-n1","2478FF292E7EBA0524FDA7A0A099BFE4-n1",`
"24C84BA99A3BE8442B55330778014BC1-n1","267A94928B5FCF974F571B10B6AE9EDC-n1","26D34BFC01C65A44096BDA85F2F0316B-n1",`
"27ABFCE95937ED7B64D054F5ECAC9358-n1","27CD0E5A622E2C9DD5F9CDB48C9A0CED-n1","27D8FC5E438D5AFC9C1AAE44377DD34C-n1",`
"2837BE533A47D15BFDE55C6C0A5A761B-n1","2AEDD0765B4C0CB54B2CEB373D5647DB-n1","2F513F93A81507F4A1D65B18E489E89F-n1",`
"30723B902E66C03378D2326E0A7DA59B-n1","30ECE2DBAA89F7121D7767F6BB6E1D3C-n1","32730435B4FACC28E81A51965DAF5CD1-n1",`
"367AE749CCB01596D9CF747281F3E3C1-n1","37FD4E6401975D7A98264A9CC059223B-n1","38C83B3A0BA8A21EA231E72251CB2975-n1",`
"39390B81C70057C46701FDFADDE09CBD-n1","3ACF0FA2323F4936D252623D02E247BE-n1","3B20EFC1F213D5796A2D56155B8D099D-n1",`
"3C5774D601F62310ED9629274325013E-n1","409152E62F3D1D33791D359B49B092AA-n1","41F27F0013D07B1CACFCACE85FDB6225-n1",`
"43DAD17D65DAC34B4176B200BF39B4BF-n1","45FBED78AC3B463FFDA53284092B73C9-n1","468645BD6F35BFCD001EDA40A14E1A90-n1",`
"47D34DD911BE76D7A8BB0FDE79682E3E-n1","493DE0BE203E68DC8C1529506DFC12A4-n1","4A2A8E72695341F89ED3B83AB153F781-n1",`
"4DC8B3A65EDA3FA1DC7A6C49910CDEC0-n1","4EEB242A7D4EF2AA226661E030D8B6C3-n1","54BD8059D2BD8EB44608137277422BC6-n1",`
"5EB6E2C568898DF81FCB0A642267A405-n1","5FAA91EB01FC7DA47F45C5C0F7BD7D49-n1","602B01FC96B5FEBBB2F7BAD4F738E877-n1",`
"6136F89F4EDC39894A81E505991B2ABE-n1","62821F9AF9C9EF1B413142B766440D7E-n1","633C6D51DBC63D6C2158F8CE5447653D-n1",`
"6387CDE081BDEB5B2A56661DBA17D11D-n1","639E4BF84A4BFF7F605B9126D5F5339B-n1","6434290E8929654CC59E9D2A85478556-n1",`
"644F3C9A758ADDCD4432949420B4BAC1-n1","6613D61B507B0A86E4952C8C1C8F8303-n1","6C0F9F7222C2E28BFB0018268043D069-n1","6F128D2140C030FD253582752EE805F8-n1",`
"6F33E3B70B8446AE77645ECC5E5FFF44-n1","71FF91D8AE7E1DF01E0FB52A125A1C3B-n1","77D38A6609DAA124E6BA379E0D89F1A8-n1","78410CDEE79DCB76EC28358776EC16E4-n1",`
"7B2BA80E31C12E00D8BA4DB0F37CEA90-n1","7D1DFDF8600120E9D5FDCDF994942738-n1","7F77179CDB2483247F8AA158F8F3D6E2-n1","7F92D3811BC326223A75F53C21715118-n1",`
"80CB329E2CDE0E2B2D9E41FA17260BFA-n1","81940C4F43685C6A3CA0A764C14BA38F-n1","8367634341A026F999E0F11E213E0739-n1","86ACC845462D95087980FBDB2D77C5FD-n1",`
"895DA171A6197A64870633F9DBD46909-n1","8CB68BF9168E41CCA271B33EB2363FFF-n1","8E0808EB203254D72723E2BA39FA9D17-n1","8F1B2930C8AA19C53FD0ABB6540AC6D6-n1",`
"8F84B55B5BF16A180AE70E93CCA927F3-n1","9224869F202C721848C0604AEC705114-n1","92308B4CFBD8157E96577E322C2105B8-n1","974898F742D2F5F36DDAEF6C12A9768B-n1",`
"9778364FB71F000E80BDAADAF50B5347-n1","9947DCBE9CA4F5630BD2F5B6EEA7FDDA-n1","9B08A2BB294F682542640521FED1A4ED-n1","9C4B728FB02CDDBB4B6FD7457E24E7E6-n1",`
"9DC85AC6A00C96694C05FBBF958B7556-n1","9E2CBC5482BB114D35A73145C7BA392F-n1","A2629ED3CBC7A1D15A20A2430BCCE06A-n1","A3885D590EC29386124A4AB22B28B34F-n1",`
"A5FEE1E3B33130ED83B971782606711D-n1","AAB4C0FAB62C04328E341C5539B50D37-n1","AC007B76BEB2D4D49FCA301925BFCC0F-n1","AD6E39A585A5AFD8AF7E04EB9E3CF999-n1",`
"ADE81146A738417FCAD6CBF2D31ADB8F-n1","AE8979BA72E13DD1041F75F2A14CD2DF-n1","B1E5471F5902939DCADE6748E6480E43-n1","B3F72E78842C0B4361E86F6556FD9A8B-n1",`
"B4DFA70ADAD6018C47C5772AA15EB56B-n1","B63292FE66C13767296752C17B678DBF-n1","B6BACD32B69BD66F772D4C1D4318854C-n1","B83D2E04805628AAA97D203F6D885FDF-n1",`
"B858D4DEE05A66D2D801F8C95A934D6D-n1","B886084C0FACA7A4D4E45372D0DFE319-n1","BCC2A9C14481C2261A963042E116E0FC-n1","BE2B731012EBA3802215E473A817B963-n1",`
"C2333459148BBAC1ED7AA05F5AC68547-n1","C2936FFF3DBBB429D0E0ECB4FF660D4A-n1","C3CF02A8F29B76990966C69056206E8E-n1","C4929A5E5FC70CCC6F1703070F6EDD95-n1",`
"C7BD165EFD3C1DBA3A347416F43FED45-n1","C86214ED431B399404FECEFFC3A407A3-n1","C8CC7EAF601E0E7803CC5080923BCEB3-n1","CC4CF6B1152E97CF50174554DD11B703-n1",`
"CC670939D9471927C74B832A218FC0A4-n1","CEC5497ACBDE09951AB863EA2BE568FF-n1","D0ADE860E090D9D4914B288A8D97AC6E-n1","D0EAAD63060FE7C7AECC8E37999CF179-n1",`
"D1141A60998068919B6F08C1042F66FF-n1","D3B23EA7798D13AAC428FB23962959CA-n1","D5025F68256A866E97AD67C0BC6903DA-n1","D87A7BF75140E209E8D549B29AB245BA-n1",`
"DA07559CCC299F4459D4338A5A09AF55-n1","DA205247B94FD572E65C9CE940306097-n1","DC0D9846121CE15D1690640622742113-n1","DC677662F33CC3541E67D8CC36E067F8-n1",`
"E3278A0EED61965FE8CBC014CF08F571-n1","E35200143ECB65A90BA0DF172FA1058C-n1","E650F50445E8050C93E14D43020CCEF8-n1","E78E4D859DADB8177BF7C61AC30C7197-n1",`
"E94FCB1306A34776B73CFEF1B64E7ECA-n1","EB1911651E8B24072E257E4ACFF39CC9-n1","EB95940EE9922E9EDB812EF0C023B33A-n1","ED589F707B17E5205A97182D80FBEC87-n1",`
"EF0ABE11A64D57C49CE6AE5B4225721C-n1","F0EB578E4F0F17A40A40664DAF3EDF7E-n1","F1DA01A85E810FDD08C552D95EF92D6C-n1","F26D975E9D7291739AB063FB0F55CB37-n1",`
"F44F7DC5D35DED640CC63DB7E44625ED-n1","F56803D6A7BF13ACB6B08C2060A0F092-n1","F56B02749495081F05252549BFB57716-n1","F76B1148BAD579B4E9F329F0E4B30A56-n1",`
"F91C7BA2C65DF02FAEDBFB2F3D2E043F-n1","F924A6CD3BD0E044A17DE13111300EA8-n1","FA03BE7FEFE57DEB742FE024368E0086-n1","FA745F26BA2085184A0C0C45EB9774F2-n1",`
"FBB0743AD34158953A82580C973FC2B0-n1","FBDBBFE61DB5F225E182A4977A0DCB22-n1","FC379C9C33C462E1553747B97BC90987-n1");

  foreach ($Session in $SESSIONS){

    invoke-expression "aws s3 cp s3://rocketmiles-provider-logs/PRODUCTION/2016-11-28/$Session 2016-11-28_Err_project/$Session --recursive --exclude '*' --include '*.xml.gz'";
  # Execute command for each URL session-ID
 
  write-host "Completed download #$i (SessionID: $Session)."
    $i++;
	Set-Location C:\rocketmiles\Amazon\2016-11-28_Err_project\$Session
	 7z e *.gz -aou -oUNZIPPED * -r
  # Un-zip files into new folder with 7-zip.
  write-host "Unzipped all files for $Session!"

Set-Location C:\rocketmiles\Amazon\
#set download directory back again (for the next file in succession).  
  }

write-host "Done downloading! All files should be unzipped in a relative sub-directory.";
#Close for-each loop after all S3 downloads complete.

Stop-transcript;

exit;
#Loop should end after all files are downloaded and un-zipped.
